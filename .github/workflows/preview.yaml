on:
  pull_request:
  workflow_dispatch:

jobs:
  check:
    runs-on: ubuntu-latest
    environment: Preview
    env:
      SENTRY_AUTH_TOKEN: ${{ secrets.SENTRY_AUTH_TOKEN }}
      SENTRY_ORG: exactly
      SENTRY_PROJECT: webapp
      SENTRY_ENVIRONMENT: development
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: 18
          cache: npm
      - run: npm ci
      - run: npm run lint
      - run: npm run build
      - run: npx unimported

  e2e:
    runs-on: ubuntu-latest
    environment: Test
    needs: check
    env:
      CYPRESS_TENDERLY_ACCESS_KEY: ${{ secrets.TENDERLY_ACCESS_KEY }}
      CYPRESS_TENDERLY_PROJECT: exactly
      CYPRESS_TENDERLY_USER: exactly
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: 18
          cache: npm
      - run: npm ci --audit false
      - uses: cypress-io/github-action@v5
        with:
          headless: true
          install: false
          record: false
          command: npm run ci
